// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    var act_code_elm, current_request, removeGreen, success_callback, use_code_button, use_code_ui_button, validateActCode;
    success_callback = function() {
      return 2 + 2;
    };
    window.showActCodeForm = function(success) {
      $.mobile.changePage($("#act_code_form"));
      return success_callback = success;
    };
    act_code_elm = $('#invitation_act_code');
    use_code_button = $('#use_this_code_button');
    use_code_ui_button = null;
    use_code_button.click(function() {
      success_callback(window.localStorage.getItem('act_code'));
      return $.mobile.changePage($('#pictures'));
    });
    validateActCode = function(data, textStatus, jqXHR) {
      act_code_elm.addClass('green');
      window.localStorage.setItem('act_code', act_code_elm.val());
      return use_code_ui_button.show();
    };
    removeGreen = function() {
      act_code_elm.removeClass('green');
      return use_code_ui_button.hide();
    };
    current_request = null;
    $(document).on('pageinit', '#act_code_form', function() {
      use_code_ui_button = use_code_button.closest('.ui-btn');
      use_code_ui_button.hide();
      return act_code_elm.bind('keyup', function(e) {
        var value;
        if (current_request) {
          current_request.abort();
        }
        use_code_ui_button.hide();
        value = $(this).val();
        if (!value || value.trim() === '') {
          return;
        }
        return current_request = $.get('http://www.lineogjakob.dk/invitations/find_by_act_code.json', {
          'invitation[act_code]': value
        }, validateActCode).fail(removeGreen);
      });
    });
    return $(document).on('pageinit', '#act_code_form', function() {
      var notRecognizedPhoneNr, phonenumber_input, recognizedPhoneNumber;
      phonenumber_input = $('#send_activation_code_phone_number');
      recognizedPhoneNumber = function(data, textStatus, jgXHR) {
        return phonenumber_input.addClass('green');
      };
      notRecognizedPhoneNr = function() {
        phonenumber_input.addClass('yellow');
        return 2 + 2;
      };
      current_request = null;
      phonenumber_input.bind('keyup', function() {
        return phonenumber_input.removeClass('green yellow');
      });
      return $('#send_act_code').click(function() {
        var phonenumber;
        phonenumber_input.removeClass('green yellow');
        phonenumber = phonenumber_input.val();
        if (current_request) {
          current_request.abort();
        }
        if (!phonenumber || phonenumber.trim() === '') {
          return;
        }
        return current_request = $.post('http://www.lineogjakob.dk/request_act_code.json', {
          'send_activation_code[phone_number]': phonenumber
        }, recognizedPhoneNumber).fail(notRecognizedPhoneNr);
      });
    });
  });

}).call(this);
